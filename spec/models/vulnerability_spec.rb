# frozen_string_literal: true

require 'rails_helper'

RSpec.describe Vulnerability, type: :model do
  context 'is valid' do
    it 'with required attributes' do
      record = described_class.new(
        description: 'Test Vulnerability',
        gem_version: create(:gem_version),
      )
      expect(record).to be_a_valid_record
    end

    it 'with optional attributes' do
      record = described_class.new(
        description: 'Test Vulnerability',
        gem_version: create(:gem_version),
        cve: '2015-8314',
        url: 'https://example.com/vulnerability1',
        patched_versions: '>= 2.0',
      )
      expect(record).to be_a_valid_record
    end
  end

  context 'is not valid' do
    it 'without a description' do
      record = described_class.new gem_version: create(:gem_version)
      expect(record).to_not be_a_valid_record
      expect(record.errors.full_messages).to eq ['Description can\'t be blank']
    end

    it 'without a gem_version' do
      record = described_class.new description: 'Test Vulnerability'
      expect(record).to_not be_a_valid_record
      expect(record.errors.full_messages).to eq ['Gem version must exist']
    end
  end
end
